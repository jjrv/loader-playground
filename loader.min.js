"use strict";var System,charto=charto||{};charto.initSystem=function(e,t,r){var o,n=typeof e;"function"==n?(t=e,e={}):"object"==n&&e||(o=e,e={}),(r=r||{}).baseURL=r.baseURL||e.baseURL||self.location.pathname.replace(/\/[^/]+$/,"/"),delete e.baseURL;var s={bluebird:["node_modules/bluebird/js/browser/bluebird.core.min.js","//unpkg.com/bluebird@3/js/browser/bluebird.core.min.js"],systemjs:["node_modules/systemjs/dist/system.js","//unpkg.com/systemjs@0.21/dist/system.js"],config:o},a=["function"!=typeof Promise&&"bluebird","systemjs",charto.patchSystem,function(){System.config(r),System.config(e)},o&&"config",t];charto.require(a,s,e.map||{})},charto.initSystemTS=function(e,t){charto.initSystem(e,t,{transpiler:"plugin-typescript",packages:{"dist/":{defaultExtension:"js"},"src/":{defaultExtension:"ts"}},meta:{"*.tsx":{defaultExtension:!1},"*.vert":{loader:"systemjs-plugin-text"},"*.frag":{loader:"systemjs-plugin-text"},"*.css":{loader:"charto-plugin-css"}},typescriptOptions:{jsx:"react"}})},charto.patchSystem=function(t){return System.register("cresolve/PathTree",[],function(e,t){var a,r;t&&t.id;return{setters:[],execute:function(){e("TreeBranch",a=function(e,t){this["/name"]=e,this[".."]=t,this["."]=this}),r=function(){function e(){this.root=new a}return e.prototype.insert=function(e,t){for(var r=this.root,o=0,n=e.split("/");o<n.length;o++){var s=n[o];r[s]||(r[s]=new a(s,r)),r=r[s]}return r["/data"]=r["/data"]||t,r},e.prototype.find=function(e,t){void 0===t&&(t={});for(var r,o,n=this.root,s=0;0<=(o=e.indexOf("/",s))&&(n=n[e.substr(s,o-s)]);)n["/data"]&&((r=t).node=n,r.next=o),s=o+1;return r},e}(),e("PathTree",r)}}}),System.register("cresolve/fetchResponse",[],function(e,t){t&&t.id;return e("fetchResponse",function(e,t){return{ok:!0,url:t,text:function(){return Promise.resolve(e)}}}),{setters:[],execute:function(){}}}),System.register("cresolve/Resolver",["cresolve/PathTree","cresolve/fetchResponse"],function(e,t){var o,i,r;t&&t.id;return{setters:[function(e){o=e},function(e){i=e}],execute:function(){r=function(){function e(e,t,r){void 0===r&&(r={map:{},meta:{},packages:{}}),this.ifExists=e,this.fetch=t,this.systemConfig=r,this.packageTree=new o.PathTree,this.pending={packages:{}},this.suffix=0,this.jsonTbl={}}return e.prototype.findStep=function(t,e){var r=this,o=e.pop();return this.ifExists(t+"/package.json").then(function(e){return t},function(){return o?r.findStep(o,e):Promise.reject(null)})},e.prototype.findPackageRoot=function(e,t,r){void 0===t&&(t=[]);for(var o,n,s,a,i="node_modules",c=e.toLowerCase(),u=r&&r.toLowerCase(),f=c.length;0<=(s=c.lastIndexOf("/",f));){if((p=c.substr(s+1,f-s))==i){!o&&n&&(s=n+1),o=void 0;break}if(o){s=f+1;break}p!=u&&p!=u+".js"||(o=e.substr(0,f+1)),n=f,f=s-1}s<0&&(s=e.length),f=2+e.indexOf("//");do{var p;a=1+e.indexOf("/",f)||s+1,(p=c.substr(f,a-f-1))!=i&&t.push(e.substr(0,a-1)+(r?"/node_modules/"+r:"")),f=a}while(a<s);return o&&t.push(o),this.findStep(t.pop(),t)},e.prototype.applyConfig=function(e){e.config(this.pending),this.port&&this.port.postMessage({method:3,config:this.pending}),this.pending={packages:{}}},e.prototype.loadPackage=function(t){return this.fetch(t+"/package.json",{cache:"force-cache"}).then(function(e){return t=e.url.replace(/\/package\.json$/i,""),e.text()}).then(function(e){return{data:e,root:t}})},e.prototype.generateName=function(){return"ANONYMOUS-"+ ++this.suffix},e.prototype.parsePackage=function(e,t,r,o,n){var s=this.systemConfig,a=this.pending,i=JSON.parse(t),c=i.main||"index.js";o=o||i.name||this.generateName(),o=this.packageTree.insert(r,o)["/data"],this.jsonTbl[o]=i;var u=r.replace(/((\/(node_modules|unpkg\.com))\/[^/]*)?$/i,"$2/"),f=u+"*";s.meta[f]||(s.meta[f]={globals:{process:"global:process"}},s.packages[u]={defaultExtension:"js"},a.meta||(a.meta={}),a.packages||(a.packages={}),a.meta[f]=s.meta[f],a.packages[u]=s.packages[u]),s.map[o]=r,a.map||(a.map={}),a.map[o]=s.map[o];var p=s.packages[o];if(p||(p={},s.packages[o]=p),p.main=c,"string"==typeof i.browser)n==c&&(n=i.browser),c=i.browser;else if("object"==typeof i.browser){p.map||(p.map={});for(var h=0,l=Object.keys(i.browser);h<l.length;h++){var g=l[h];p.map[g]=i.browser[g]||"@empty"}}return"typescript"==o&&(p.meta||(p.meta={}),p.meta["*.js"]={exports:"ts",format:"global"}),a.packages[o]=p,this.applyConfig(e),(r+"/"+(n=n||c)).replace(/(\/[^./]+)$/,"$1.js")},e.prototype.getRootPackage=function(o,t){var n=this,e=this.packageTree.find(t);return e?Promise.resolve(e):this.findPackageRoot(t).then(function(e){return n.loadPackage(e)}).then(function(e){var t=e.data,r=e.root;n.parsePackage(o,t,r)}).catch(function(){var e=t.replace(/\/[^/]*$/,"");n.packageTree.insert(e,n.generateName())})},e.prototype.findFile=function(o,e,t,r){var n=this;this.systemConfig;if(e.match(/^\.\.?(\/|$)/)){var s=r.replace(/(\/|\.[a-z]+)$/,"/package.json");return this.fetch(s,{cache:"force-cache"}).then(function(e){return e.text()}).then(function(e){return n.parsePackage(o,e,s)})}var a=e.match(/^((@[0-9a-z][-_.0-9a-z]*\/)?[0-9a-z][-_.0-9a-z]*)(\/(.*))?/);if(!a)throw Error("Cannot parse missing dependency using Node.js module resolution: "+e);var i=a[1],c=a[4];return(t?this.getRootPackage(o,t):Promise.resolve()).then(function(){return n.findPackageRoot(r,["//unpkg.com/"+i],i)}).catch(function(){return Promise.reject(Error("Cannot find root of package using Node.js module resolution: "+i))}).then(function(e){return n.loadPackage(e)}).then(function(e){var t=e.data,r=e.root;return n.parsePackage(o,t,r,i,c)})},e.prototype.systemResolve=function(s,e,t,r){var a,i,c=this,u=this.systemConfig,o=function(e){return i=(a=e).match(/\.ts$/)?a+"x":a.replace(/(\.js)?$/,"/index.js"),s.registry.get(a)?a:s.registry.get(i)?i:c.ifExists(a).catch(function(){return c.ifExists(i)})};return r.call(s,e,t).then(o).catch(function(){return c.findFile(s,e,t,a).then(o)}).then(function(n){var e=r.call(s,n,t);return n!=i||c.getRootPackage(s,i).then(function(e){e||(e=c.packageTree.find(i));var t=c.pending,r=e.node["/data"];u.map[r]||(u.map[r]=i.substr(0,e.next),t.map||(t.map={}),t.map[r]=u.map[r]);var o=u.packages[r];o||(o={},u.packages[r]=o),o.map||(o.map={}),o.map["."+a.substr(e.next)]="."+i.substr(e.next),t.packages[r]=o,c.applyConfig(s),a=n}),e})},e.prototype.patchSystem=function(e,t){void 0===t&&(t="production");var r=e.resolve,o=this;return e.set("global:process",e.newModule({env:{NODE_ENV:t}})),e.resolve=function(e,t){return o.systemResolve(this,e,t,r)},this},e.prototype.createPort=function(t,o,a,i){var c=this,e=new MessageChannel,u=e.port1;return u.onmessage=function(e){var n=e.data,s=n.method;function r(e,t,r){var o={method:s,uri:n.uri,success:e};t&&(o.target=t),r&&(o.body=r),u.postMessage(o)}switch(s){case 0:c.ifExists(n.uri).then(function(e){r(!0,e)},function(e){r(!1)});break;case 1:c.fetch(n.uri,n.config||{}).then(function(t){t.text().then(function(e){r(!0,t.url,e)})},function(e){r(!1)});break;case 2:n.success?o(i):a();break;case 3:!function e(t,r){for(var o=0,n=Object.keys(r);o<n.length;o++){var s=n[o];"object"==typeof t[s]?e(t[s],r[s]):t[s]=r[s]}}(c.systemConfig,n.config),t.config(n.config)}},e.port2},e.prototype.setPort=function(a){var s=this;function e(s,e){return function(r,o){var n=e[r];return n||((n={}).promise=new Promise(function(e,t){n.resolve=e,n.reject=t,a.postMessage({method:s,uri:r,config:o})}),e[r]=n),n.promise}}this.existsCache={},this.fetchCache={},this.port=a,this.ifExists=e(0,this.existsCache),this.fetch=e(1,this.fetchCache),a.onmessage=function(e){var t,r=e.data;switch(r.method){case 0:var o=s.existsCache[r.uri];if(t=o,r.success)return o.resolve(r.target);break;case 1:var n=s.fetchCache[r.uri];if(t=n,r.success)return n.resolve(i.fetchResponse(r.body,r.target));break;default:return}t.reject("")}},e.prototype.reportLoad=function(e){this.port.postMessage({method:2,success:e})},e}(),e("Resolver",r)}}}),System.register("cresolve/fetch",["cresolve/fetchResponse"],function(e,t){var h,l,r,f,o,n,s=t&&t.id;function g(e){var t=e.replace(/^file:\/\//,"");return r&&(t.match(/^\/[0-9A-Za-z]+:\//)&&(t=t.substr(1)),t=t.replace(/\//g,"\\")),t}function a(e){var t=e;return r&&(t=t.replace(/\\/g,"/")).match(/^[0-9A-Za-z]+:\//)&&(t="/"+t),t.replace(/^\//,"file:///")}function m(i,c,u){void 0===u&&(u=3);var e=new Promise(function(o,n){u||n(Error("Too many redirects"));var e=i.substr(0,7).toLowerCase(),t;if("http://"==e)t=eval("require('http')");else{if("https:/"!=e)return n(Error());t=eval("require('https')")}var s=eval("require('url')"),r=s.parse(i);c&&(r.method="HEAD");var a=t.request(r,function(e){if(200!=e.statusCode){if(e.statusCode&&f[e.statusCode]){var t=e.headers.location;return a.abort(),t?o(m(s.resolve(i,t),c,u-1)):n(e)}return a.abort(),n(e)}if(c)return a.abort(),o({uri:i,text:""});var r=[];e.on("error",n),e.on("data",function(e){return r.push(e)}),e.on("end",function(){return o({uri:i,text:Buffer.concat(r).toString("utf-8")})})});a.on("error",n),a.end()});return e}function i(c){var e=o[c]||new Promise(function(r,o){var e=c.substr(0,7).toLowerCase();if(l)if("file://"==e){var t=eval("require('fs')");t.stat(g(c),function(e,t){return e?o(e):r(c)})}else r(m(c,!0).then(function(){return c}));else{var n="object"==typeof window&&window.sessionStorage,s="cresolve/ifExists/"+c,a=n&&n.getItem(s);if(a)return void(a.match(/^[0-9]+$/)?o({status:+a}):r(a));var i=new XMLHttpRequest;i.onerror=o,i.onload=function(){var e=i.status,t=i.getResponseHeader("Content-Type");t&&t.match(/^text\/html/i)&&(e=404),200!=e?(n&&n.setItem(s,""+e),o(i)):(c=i.responseURL,n&&n.setItem(s,c),r(c))},i.open("HEAD",c,!0),i.send()}});return o[c]=e,e}function c(f,e){var p=e&&"force-cache"==e.cache,t=p&&n[f]||new Promise(function(r,o){var e=f.substr(0,7).toLowerCase();if(l)if("file://"==e){var t=eval("require('fs')");t.readFile(g(f),"utf-8",function(e,t){return e?o(e):r(h.fetchResponse(t,f))})}else r(m(f).then(function(e){var t=e.uri,r=e.text;return h.fetchResponse(r,t)}));else{var n="object"==typeof window&&window.sessionStorage,s="cresolve/fetch/"+f,a="cresolve/fetch-uri/"+f;if(p&&n){var i=n.getItem(s),c=n.getItem(a);if(i&&c)return r(h.fetchResponse(i,c))}var u=new XMLHttpRequest;u.onerror=o,u.onload=function(){200!=u.status?o(u):(p&&n&&(n.setItem(s,""+u.responseText),n.setItem(a,""+u.responseURL)),r(h.fetchResponse(u.responseText,u.responseURL)))},u.open("GET",f,!0),u.send()}});return p&&(n[f]=t),t}return e("url2path",g),e("path2url",a),e("request",m),e("ifExists",i),e("fetch",c),{setters:[function(e){h=e}],execute:function(){e("isNode",l="object"==typeof process&&"[object process]"==Object.prototype.toString.call(process)),e("isWin",r=l&&"string"==typeof process.platform&&"win"==process.platform.substr(0,3)),e("redirectCodes",f={301:!0,302:!0,303:!0,307:!0,308:!0}),o={},n={}}}}),System.register("cresolve/index",["cresolve/Resolver","cresolve/fetch"],function(o,e){e&&e.id;function t(e){var t={};for(var r in e)"default"!==r&&(t[r]=e[r]);o(t)}return{setters:[function(e){t(e)},function(e){t(e)}],execute:function(){}}}),System.register("cresolve",["cresolve/index"],function(o,e){e&&e.id;return{setters:[function(e){!function(e){var t={};for(var r in e)"default"!==r&&(t[r]=e[r]);o(t)}(e)}],execute:function(){}}}),System.import("cresolve").then(function(e){charto.resolver=new e.Resolver(e.ifExists,e.fetch,charto.resolverConfig).patchSystem(t||System),charto.systemConfig=charto.resolver.systemConfig,charto.resolverPort&&charto.resolver.setPort(charto.resolverPort)})},charto.requireCache={},charto.require=function(s,e,t){var a="object"==typeof window&&window.sessionStorage,i=charto.requireCache,c=[],u=0;function f(){for(var e;c.length;){var t=c.shift();if("function"==typeof t){if(e=t(),e&&"object"==typeof e&&"function"==typeof e.then){e.then(f);break}}else eval(t)}}function p(t,r,o){function e(e){if(!o.length)throw e;p(t,r,o)}var n=new XMLHttpRequest;n.onerror=e,n.onload=function(){if(200!=n.status)return e(n.status);i[r]=n.responseURL,a&&a.setItem(r,i[r]),c[t]=n.responseText,++u>=s.length&&f()},n.open("GET",o.shift(),!0),n.send()}for(var r=0;r<s.length;++r){var o=s[r];if("string"==typeof o){var n=e[o],h="charto/resolve/"+o,l=i[h]||a&&a.getItem(h)||t[o];"string"==typeof n&&(n=[n]),l&&n.unshift(l),p(r,h,n)}else c[r]=o||function(){},++u}},"object"==typeof document&&"object"==typeof document.currentScript?charto.loaderPath=document.currentScript.src:function(){try{throw Error()}catch(e){var t=e.stack.match(/[A-Za-z]+:\/+[^/ \t\n]*\/[^: \t\n]+/);t&&(charto.loaderPath=t[0])}}(),charto.createWorker=function(n){var s=new Worker(charto.loaderPath);return{ready:new Promise(function(e,t){var r={uri:n,config:System.getConfig(),generated:charto.systemConfig,cache:charto.requireCache},o="function"==typeof MessageChannel&&charto.resolver.createPort(System,e,t,s);o?(r.port=o,s.postMessage(r,[o])):(s.postMessage(r),e(s))}),worker:s}},"undefined"!=typeof WorkerGlobalScope&&self instanceof WorkerGlobalScope&&"function"!=typeof onmessage&&(charto.onmessage=function(e){var t=charto.messageQueue;if(t)return t.push(e);var r=e.data.uri,o=charto.initSystem;t=[],charto.messageQueue=t,r.match(/\.ts$/i)&&(o=charto.initSystemTS),charto.resolverPort=e.data.port,charto.resolverConfig=e.data.generated,charto.requireCache=e.data.cache||{},o(e.data.config||{},function(){System.import(r).then(function(){if(charto.resolver.reportLoad(!0),t.length&&"function"==typeof onmessage&&onmessage!=charto.onmessage){for(var e=0;e<t.length;++e)onmessage(t[e]);t=void 0,charto.messageQueue=t}}).catch(function(e){throw charto.resolver.reportLoad(!1),e.originalErr||e})})},onmessage=charto.onmessage);
